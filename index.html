
<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustave Database Architecture: A Comprehensive Enhancement Strategy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary: #1e3a2e;
            --color-secondary: #2d5a47;
            --color-accent: #4a7c59;
            --color-light: #f8faf9;
            --color-muted: #6b7280;
            --color-earth: #8b7355;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #1f2937;
        }
        
        .serif {
            font-family: 'Crimson Text', serif;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
        }
        
        .grain-overlay {
            position: relative;
        }
        
        .grain-overlay::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(255,255,255,0.1) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 4px 4px;
            pointer-events: none;
        }
        
        .toc-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: rgba(248, 250, 249, 0.98);
            backdrop-filter: blur(10px);
            border-right: 1px solid #e5e7eb;
            z-index: 50;
            overflow-y: auto;
            padding: 2rem 1.5rem;
        }
        
        .main-content {
            margin-left: 280px;
            min-height: 100vh;
        }
        
        .section-padding {
            padding: 4rem 3rem;
        }
        
        @media (max-width: 1024px) {
            .toc-fixed {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .toc-fixed.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .citation {
            color: var(--color-accent);
            text-decoration: none;
            font-weight: 500;
        }
        
        .citation:hover {
            text-decoration: underline;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, var(--color-light) 0%, #ffffff 100%);
            border-left: 4px solid var(--color-accent);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .grid-bento {
            display: grid;
            grid-template-columns: 2fr 1fr;
            grid-template-rows: auto auto;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .bento-main {
            grid-row: 1 / 3;
        }
        
        .bento-side-1 {
            grid-column: 2;
            grid-row: 1;
        }
        
        .bento-side-2 {
            grid-column: 2;
            grid-row: 2;
        }
        
        @media (max-width: 768px) {
            .section-padding {
                padding: 2rem 1rem;
            }
            
            .grid-bento {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .bento-main {
                grid-row: auto;
            }
        }
        
        @media (max-width: 390px) {
            .hero-gradient h1 {
                font-size: 2.25rem;
            }
        }
    </style>
  </head>

  <body class="bg-gray-50">
    <!-- Fixed Table of Contents -->
    <nav class="toc-fixed" id="toc">
      <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Table of Contents</h2>
        <ul class="space-y-2 text-sm">
          <li>
            <a href="#executive-summary" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Executive Summary</a>
          </li>
          <li>
            <a href="#enhancing-security" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">1. Enhancing Security</a>
          </li>
          <li class="ml-4">
            <a href="#hybrid-authorization" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">1.1 Hybrid Authorization</a>
          </li>
          <li class="ml-4">
            <a href="#granular-rls" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">1.2 Granular RLS Policies</a>
          </li>
          <li class="ml-4">
            <a href="#securing-data" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">1.3 Securing Data</a>
          </li>
          <li>
            <a href="#optimizing-performance" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">2. Optimizing Performance</a>
          </li>
          <li class="ml-4">
            <a href="#scaling-workloads" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">2.1 Scaling Workloads</a>
          </li>
          <li class="ml-4">
            <a href="#advanced-indexing" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">2.2 Advanced Indexing</a>
          </li>
          <li class="ml-4">
            <a href="#data-partitioning" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">2.3 Data Partitioning</a>
          </li>
          <li>
            <a href="#refining-data-model" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">3. Refining Data Model</a>
          </li>
          <li class="ml-4">
            <a href="#user-data-consolidation" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">3.1 User Data Consolidation</a>
          </li>
          <li class="ml-4">
            <a href="#carbon-credit-lifecycle" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">3.2 Carbon Credit Lifecycle</a>
          </li>
          <li class="ml-4">
            <a href="#financial-systems" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">3.3 Financial Systems</a>
          </li>
          <li>
            <a href="#data-integrity" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">4. Data Integrity</a>
          </li>
          <li class="ml-4">
            <a href="#validation-constraints" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">4.1 Validation & Constraints</a>
          </li>
          <li class="ml-4">
            <a href="#audit-logging" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">4.2 Audit & Logging</a>
          </li>
          <li>
            <a href="#conclusion" class="block py-1 px-2 rounded hover:bg-gray-100 transition-colors">Conclusion</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Hero Section with Bento Layout -->
      <header class="hero-gradient grain-overlay text-white">
        <div class="section-padding">
          <div class="max-w-7xl mx-auto">
            <div class="grid-bento">
              <div class="bento-main">
                <div class="mb-6">
                  <span class="inline-block px-3 py-1 bg-white/20 rounded-full text-sm font-medium mb-4">
                    Database Architecture Enhancement
                  </span>
                  <h1 class="serif text-5xl font-bold leading-tight mb-6">
                    <em>Sustave Platform</em>
                    <br>
                    Database Architecture
                  </h1>
                  <p class="text-xl text-white/90 leading-relaxed mb-8">
                    A comprehensive strategy for enhancing PostgreSQL database architecture with advanced security,
                    performance optimization, and refined data modeling for sustainable agriculture platforms.
                  </p>
                </div>
              </div>

              <div class="bento-side-1 bg-white/10 backdrop-blur-sm rounded-lg p-6">
                <h3 class="font-semibold mb-3">Key Focus Areas</h3>
                <ul class="space-y-2 text-sm text-white/90">
                  <li class="flex items-center">
                    <i class="fas fa-shield-alt w-4 mr-2"></i>
                    Security & Access Control
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-tachometer-alt w-4 mr-2"></i>
                    Performance & Scalability
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-leaf w-4 mr-2"></i>
                    Carbon Credit Lifecycle
                  </li>
                  <li class="flex items-center">
                    <i class="fas fa-check-circle w-4 mr-2"></i>
                    Data Integrity & Validation
                  </li>
                </ul>
              </div>

              <div class="bento-side-2 bg-white/10 backdrop-blur-sm rounded-lg p-6">
                <h3 class="font-semibold mb-3">Technical Stack</h3>
                <div class="text-sm text-white/90">
                  <div class="mb-2">
                    <strong>PostgreSQL:</strong> 13+
                  </div>
                  <div class="mb-2">
                    <strong>Extensions:</strong> Citus, TimescaleDB
                  </div>
                  <div>
                    <strong>Security:</strong> RLS, pgcrypto
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Executive Summary -->
      <section id="executive-summary" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">Executive Summary</h2>

          <div class="prose prose-lg max-w-none">
            <p class="text-xl text-gray-700 mb-6 leading-relaxed">
              To improve your Sustave platform's PostgreSQL database architecture, a comprehensive approach focusing on security, performance, and data integrity is essential. Key enhancements include implementing a hybrid authorization model using Row-Level Security (RLS) for data isolation, leveraging specialized extensions like TimescaleDB for time-series data and Citus for horizontal scaling, and refining the data model by normalizing user-related tables and enhancing the carbon credit lifecycle management.
            </p>

            <div class="grid md:grid-cols-3 gap-6 my-8">
              <div class="bg-gray-50 p-6 rounded-lg">
                <div class="text-green-600 mb-3">
                  <i class="fas fa-shield-alt text-2xl"></i>
                </div>
                <h4 class="font-semibold mb-2">Enhanced Security</h4>
                <p class="text-sm text-gray-600">Implement hybrid authorization with RLS and external policy services for granular access control.</p>
              </div>

              <div class="bg-gray-50 p-6 rounded-lg">
                <div class="text-green-600 mb-3">
                  <i class="fas fa-rocket text-2xl"></i>
                </div>
                <h4 class="font-semibold mb-2">Performance Optimization</h4>
                <p class="text-sm text-gray-600">Scale horizontally with Citus and optimize time-series data with TimescaleDB.</p>
              </div>

              <div class="bg-gray-50 p-6 rounded-lg">
                <div class="text-green-600 mb-3">
                  <i class="fas fa-leaf text-2xl"></i>
                </div>
                <h4 class="font-semibold mb-2">Data Model Refinement</h4>
                <p class="text-sm text-gray-600">Streamline user data and enhance carbon credit lifecycle management.</p>
              </div>
            </div>

            <p class="text-gray-700">
              Additionally, strengthening data validation with constraints and triggers, and establishing robust audit and logging mechanisms will ensure the platform's reliability, scalability, and security as it grows.
            </p>
          </div>
        </div>
      </section>

      <!-- Section 1: Enhancing Security -->
      <section id="enhancing-security" class="section-padding bg-gray-50">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">1. Enhancing Security with Advanced Access Control</h2>

          <!-- Hybrid Authorization -->
          <div id="hybrid-authorization" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">1.1 Implementing a Hybrid Authorization Model</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">1.1.1 Leveraging PostgreSQL Row-Level Security (RLS) for Data Isolation</h4>

            <p class="text-gray-700 mb-6">
              PostgreSQL's Row-Level Security (RLS) is a powerful feature that allows for the implementation of fine-grained access control policies directly at the database level. By enabling RLS on a table, database administrators can define policies that restrict which rows a user can access or modify, based on a set of predefined rules.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Implementation Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
CREATE POLICY farmer_farm_activities_policy ON farm_activities
FOR ALL
TO farmer
USING (farmer_id = (SELECT id FROM users WHERE email = current_user))
WITH CHECK (farmer_id = (SELECT id FROM users WHERE email = current_user));</pre>
            </div>

            <p class="text-gray-700 mb-6">
              This policy ensures that a user with the <code>farmer</code> role can only perform operations on rows in the <code>farm_activities</code> table where the <code>farmer_id</code> matches their own user ID. The filtering is done at the database level and cannot be bypassed by the application.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">1.1.2 Integrating an External Authorization Service for Complex Policies</h4>

            <p class="text-gray-700 mb-6">
              While PostgreSQL's RLS is effective for simple data isolation, it can become cumbersome when dealing with complex authorization requirements. As the Sustave platform grows, the need for more sophisticated access control mechanisms, such as role-based access control (RBAC) and attribute-based access control (ABAC), will become increasingly important.
            </p>

            <p class="text-gray-700 mb-6">
              An external authorization service like <a href="https://www.openpolicyagent.org/" class="citation">Open Policy Agent (OPA)</a> can provide a dedicated policy decision point, separating the authorization logic from the application and database layers. This separation of concerns allows for centralized policy management and greater flexibility for complex authorization scenarios.
            </p>
          </div>

          <!-- Granular RLS Policies -->
          <div id="granular-rls" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">1.2 Designing Granular RLS Policies for Multi-Tenant Access</h3>

            <div class="grid md:grid-cols-2 gap-6">
              <div class="bg-white p-6 rounded-lg shadow-sm">
                <h4 class="font-semibold mb-3 text-gray-800">Farmer Policies</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li>• Restrict access to own farm data only</li>
                  <li>• Control access to farm activities and acre NFTs</li>
                  <li>• Limit carbon credit visibility</li>
                </ul>
              </div>

              <div class="bg-white p-6 rounded-lg shadow-sm">
                <h4 class="font-semibold mb-3 text-gray-800">Investor Policies</h4>
                <ul class="text-sm text-gray-700 space-y-2">
                  <li>• Access only owned investment portfolios</li>
                  <li>• View invested acre NFT performance</li>
                  <li>• Track personal rewards and returns</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Securing Data -->
          <div id="securing-data" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">1.3 Securing Sensitive Data and Transactions</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">1.3.1 Encrypting Sensitive Columns with pgcrypto</h4>

            <p class="text-gray-700 mb-6">
              The <code>pgcrypto</code> extension provides a robust set of cryptographic functions for encrypting sensitive data at the column level. This is particularly important for KYC document hashes, wallet addresses, and other sensitive information.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Password Hashing Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
INSERT INTO users (email, password_hash)
VALUES ('user@example.com', crypt('my_password', gen_salt('bf')));</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">1.3.2 Implementing SSL/TLS for Data in Transit</h4>

            <p class="text-gray-700 mb-6">
              SSL/TLS encryption is critical for securing communication between the application and database. PostgreSQL supports various SSL modes, from <code>require</code> to <code>verify-full</code>, providing different levels of security assurance.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">1.3.3 Auditing Administrative Actions and Configuration Changes</h4>

            <p class="text-gray-700 mb-6">
              Comprehensive audit logging tracks all changes made to the database, including user role modifications, system configuration updates, and sensitive data changes. The <code>audit_logs</code> table provides a foundation for this security monitoring.
            </p>
          </div>
        </div>
      </section>

      <!-- Section 2: Optimizing Performance -->
      <section id="optimizing-performance" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">2. Optimizing Performance and Scalability</h2>

          <!-- Scaling Workloads -->
          <div id="scaling-workloads" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">2.1 Scaling the Database for High-Volume Workloads</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.1.1 Implementing Horizontal Scaling with Citus for Sharding</h4>

            <p class="text-gray-700 mb-6">
              As the Sustave platform grows, horizontal scaling with the <a href="https://www.citusdata.com/" class="citation">Citus extension</a> becomes essential. Citus transforms PostgreSQL into a distributed database by sharding large tables across multiple nodes, allowing for parallel processing of queries and significant increases in storage capacity and throughput.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Citus Implementation Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
-- Create distributed tables
SELECT create_distributed_table('farm_activities', 'farmer_id');
SELECT create_distributed_table('investment_portfolios', 'user_id');

-- Enable real-time queries
SELECT create_reference_table('users');
SELECT create_reference_table('tokens');</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.1.2 Utilizing TimescaleDB for Time-Series Data Management</h4>

            <p class="text-gray-700 mb-6">
              <a href="https://www.timescale.com/" class="citation">TimescaleDB</a> is optimized for ingesting, storing, and querying large volumes of time-stamped data. The platform's IoT sensor readings, historical price data, and user activity logs are ideal candidates for TimescaleDB hypertables.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.1.3 Considering Vertical Scaling for Performance Bottlenecks</h4>

            <p class="text-gray-700 mb-6">
              While horizontal scaling is the long-term strategy, vertical scaling can address immediate performance bottlenecks. Increasing CPU cores, RAM, or upgrading to faster storage devices can provide significant performance improvements for specific workload types.
            </p>
          </div>

          <!-- Advanced Indexing -->
          <div id="advanced-indexing" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">2.2 Advanced Indexing Strategies for Faster Queries</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.2.1 Creating Composite Indexes for Frequently Joined Tables</h4>

            <p class="text-gray-700 mb-6">
              Composite indexes on multiple columns can dramatically improve query performance for common join patterns. The order of columns should be based on query patterns, with equality-checked columns first.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Composite Index Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
-- For farmer activity queries
CREATE INDEX idx_farm_activities_farmer_date 
ON farm_activities (farmer_id, date);

-- For investment portfolio queries
CREATE INDEX idx_investment_portfolios_user_asset 
ON investment_portfolios (user_id, asset_type);</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.2.2 Implementing Partial Indexes for Filtered Queries</h4>

            <p class="text-gray-700 mb-6">
              Partial indexes on subset of rows defined by a WHERE clause can optimize queries that only access a small portion of table data.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Partial Index Examples</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
-- For verified carbon credits
CREATE INDEX idx_carbon_credits_verified 
ON carbon_credits (acre_nft_id) 
WHERE verification_status = 'verified';

-- For active acre NFTs
CREATE INDEX idx_acre_nfts_active 
ON acre_nfts (farmer_id) 
WHERE status = 'active';</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.2.3 Using GIN Indexes for Full-Text Search on JSONB Columns</h4>

            <p class="text-gray-700 mb-6">
              GIN indexes are ideal for searching within JSONB columns and implementing full-text search functionality.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">GIN Index Examples</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
-- For searching crops in user_profiles
CREATE INDEX idx_user_profiles_crops_gin 
ON user_profiles USING GIN (crops);

-- For full-text search on proposals
CREATE INDEX idx_proposals_title_gin 
ON proposals USING GIN (to_tsvector('english', title));</pre>
            </div>
          </div>

          <!-- Data Partitioning -->
          <div id="data-partitioning" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">2.3 Data Partitioning for Large Tables</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.3.1 Partitioning Transaction and Log Tables by Time</h4>

            <p class="text-gray-700 mb-6">
              Time-based partitioning is highly effective for tables like <code>token_transfers</code>, <code>marketplace_transactions</code>, and <code>api_logs</code>. This enables partition pruning and efficient data management.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Time-Based Partitioning Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
-- Create partitioned table
CREATE TABLE token_transfers (
    tx_hash VARCHAR(66),
    from_address VARCHAR(42),
    to_address VARCHAR(42),
    amount NUMERIC(20,6),
    token_id INT,
    timestamp TIMESTAMPTZ
) PARTITION BY RANGE (timestamp);

-- Create monthly partitions
CREATE TABLE token_transfers_202401 PARTITION OF token_transfers
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">2.3.2 Partitioning User-Related Tables by User ID or Region</h4>

            <p class="text-gray-700 mb-6">
              User-centric partitioning can improve performance for multi-tenant queries by co-locating all data for a specific user on the same partition.
            </p>
          </div>
        </div>
      </section>

      <!-- Section 3: Refining Data Model -->
      <section id="refining-data-model" class="section-padding bg-gray-50">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">3. Refining the Data Model and Business Logic</h2>

          <!-- User Data Consolidation -->
          <div id="user-data-consolidation" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">3.1 Consolidating and Normalizing User-Related Data</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.1.1 Merging User Profiles into the Main Users Table</h4>

            <p class="text-gray-700 mb-6">
              The current separation between <code>users</code> and <code>user_profiles</code> tables can be streamlined by merging them into a single table. This reduces join operations and simplifies data access patterns.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Table Structure Enhancement</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
ALTER TABLE users 
ADD COLUMN location TEXT,
ADD COLUMN farm_size DECIMAL(10,2),
ADD COLUMN crops JSONB,
ADD COLUMN bio TEXT;</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.1.2 Standardizing KYC Document Storage and Status</h4>

            <p class="text-gray-700 mb-6">
              Enhancing the <code>kyc_documents</code> table with reference tables for document types and statuses improves data integrity and flexibility.
            </p>
          </div>

          <!-- Carbon Credit Lifecycle -->
          <div id="carbon-credit-lifecycle" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">3.2 Enhancing the Carbon Credit Lifecycle Management</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.2.1 Structuring Carbon Credit Data with a JSONB Schema</h4>

            <p class="text-gray-700 mb-6">
              The <code>carbon_credits</code> table can be enhanced with a <code>JSONB</code> column to store detailed metadata about each carbon credit, following the <a href="https://rmi.org/carbon-crediting-data-framework/" class="citation">Carbon Crediting Data Framework (CCDF)</a> principles.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">JSONB Schema Enhancement</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
ALTER TABLE carbon_credits 
ADD COLUMN metadata JSONB;

-- Example metadata structure
{
  "methodology": "VM0042",
  "verifier": {
    "name": "Verra",
    "id": "VRR-12345"
  },
  "co_benefits": ["biodiversity", "community"],
  "gps_coordinates": {
    "latitude": 4.7110,
    "longitude": -74.0721
  }
}</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.2.2 Automating Carbon Credit Generation and Verification</h4>

            <p class="text-gray-700 mb-6">
              The platform's existing <code>generate_carbon_credits</code> function provides a foundation for automation. Integration with third-party verification services can further streamline the verification process.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.2.3 Implementing a System for Carbon Credit Retirement and Trading</h4>

            <p class="text-gray-700 mb-6">
              Enhancing the carbon credit marketplace with retirement tracking and advanced trading features like bidding systems.
            </p>
          </div>

          <!-- Financial Systems -->
          <div id="financial-systems" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">3.3 Streamlining Financial and Reward Systems</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.3.1 Automating Quarterly Reward Distribution</h4>

            <p class="text-gray-700 mb-6">
              The <code>calculate_quarterly_rewards</code> function can be enhanced with performance-based calculations and a comprehensive reward payment tracking system.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.3.2 Managing Platform Fees and Commissions</h4>

            <p class="text-gray-700 mb-6">
              The existing <code>platform_fees</code> system provides excellent foundation for dynamic fee structures and tiered pricing models.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">3.3.3 Tracking Token Utilization and Staking Positions</h4>

            <p class="text-gray-700 mb-6">
              Enhancing the <code>token_utilization</code> and <code>staking_positions</code> tables with more granular tracking and historical data.
            </p>
          </div>
        </div>
      </section>

      <!-- Section 4: Data Integrity -->
      <section id="data-integrity" class="section-padding bg-white">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold text-gray-900 mb-8">4. Improving Data Integrity and Validation</h2>

          <!-- Validation & Constraints -->
          <div id="validation-constraints" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">4.1 Strengthening Data Validation with Constraints and Triggers</h3>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">4.1.1 Validating Geographic Coordinates for Farm Locations</h4>

            <p class="text-gray-700 mb-6">
              PostGIS geographic coordinates must be validated to ensure they fall within valid ranges (-180 to 180 for longitude, -90 to 90 for latitude).
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Geographic Validation Trigger</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
CREATE TRIGGER validate_geolocation_trigger
BEFORE INSERT OR UPDATE ON farmers
FOR EACH ROW
EXECUTE FUNCTION validate_geolocation();</pre>
            </div>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">4.1.2 Ensuring Data Consistency in Farm Activities and Yields</h4>

            <p class="text-gray-700 mb-6">
              Farm activity data must be validated for realistic yield values and proper activity types.
            </p>

            <h4 class="text-lg font-semibold text-gray-800 mb-4">4.1.3 Preventing Duplicate Carbon Credits for a Single Acre</h4>

            <p class="text-gray-700 mb-6">
              Unique constraints prevent duplicate carbon credit generation for the same acre and time period.
            </p>

            <div class="highlight-box">
              <h5 class="font-semibold mb-3">Unique Constraint Example</h5>
              <pre class="bg-gray-800 text-green-400 p-4 rounded-lg text-sm overflow-x-auto">
ALTER TABLE carbon_credits
ADD CONSTRAINT unique_acre_period 
UNIQUE (acre_nft_id, generation_period);</pre>
            </div>
          </div>

          <!-- Audit & Logging -->
          <div id="audit-logging" class="mb-12">
            <h3 class="serif text-2xl font-semibold text-gray-900 mb-6">4.2 Audit & Logging</h3>

            <p class="text-gray-700 mb-6">
              Comprehensive audit logging tracks all changes to critical data and administrative actions. The existing <code>audit_logs</code> and <code>admin_actions</code> tables provide a foundation for this security monitoring.
            </p>

            <div class="grid md:grid-cols-3 gap-6">
              <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold mb-3">Configuration Changes</h4>
                <p class="text-sm text-gray-700">Track all system configuration modifications with before/after values</p>
              </div>

              <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold mb-3">User Role Changes</h4>
                <p class="text-sm text-gray-700">Monitor privilege escalation and access control modifications</p>
              </div>

              <div class="bg-gray-50 p-6 rounded-lg">
                <h4 class="font-semibold mb-3">Tokenomic Updates</h4>
                <p class="text-sm text-gray-700">Audit changes to fee structures and reward calculations</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Conclusion -->
      <section id="conclusion" class="section-padding bg-gray-900 text-white">
        <div class="max-w-4xl mx-auto">
          <h2 class="serif text-3xl font-bold mb-8">Conclusion</h2>

          <div class="prose prose-lg max-w-none text-gray-300">
            <p class="text-xl mb-6 leading-relaxed">
              The proposed enhancements to the Sustave platform's PostgreSQL database architecture represent a comprehensive approach to building a secure, scalable, and reliable foundation for sustainable agriculture finance.
            </p>

            <div class="grid md:grid-cols-2 gap-8 my-8">
              <div>
                <h3 class="text-xl font-semibold mb-4 text-white">Security Foundation</h3>
                <p class="text-gray-300">
                  The hybrid authorization model combining RLS with external policy services provides robust data isolation while maintaining flexibility for complex access control scenarios.
                </p>
              </div>

              <div>
                <h3 class="text-xl font-semibold mb-4 text-white">Performance Excellence</h3>
                <p class="text-gray-300">
                  Horizontal scaling with Citus and specialized time-series management with TimescaleDB ensure the platform can handle growth while maintaining responsive performance.
                </p>
              </div>
            </div>

            <p class="text-gray-300 mb-6">
              The refinements to the data model, particularly in carbon credit lifecycle management and user data consolidation, create a more streamlined and maintainable architecture. Enhanced data validation and comprehensive audit logging ensure data integrity and regulatory compliance.
            </p>

            <p class="text-gray-300">
              Together, these improvements position the Sustave platform for sustainable growth while maintaining the security, performance, and reliability that users expect from a modern agricultural finance platform.
            </p>
          </div>
        </div>
      </section>
    </main>

    <script>
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    
                    // Close TOC on mobile after clicking a link
                    if (window.innerWidth <= 1024) {
                        document.getElementById('toc').classList.remove('open');
                    }
                }
            });
        });

        // Mobile TOC toggle
        const tocToggle = document.createElement('button');
        tocToggle.innerHTML = '<i class="fas fa-bars"></i>';
        tocToggle.className = 'fixed top-4 left-4 z-50 bg-white p-3 rounded-lg shadow-lg lg:hidden';
        tocToggle.onclick = function(e) {
            e.stopPropagation();
            document.getElementById('toc').classList.toggle('open');
        };
        document.body.appendChild(tocToggle);

        // Close TOC when clicking outside on mobile
        document.addEventListener('click', function(e) {
            const toc = document.getElementById('toc');
            if (window.innerWidth <= 1024 && toc.classList.contains('open') && 
                !toc.contains(e.target) && e.target !== tocToggle) {
                toc.classList.remove('open');
            }
        });

        // Reset TOC state on desktop
        window.addEventListener('resize', function() {
            const toc = document.getElementById('toc');
            if (window.innerWidth > 1024) {
                toc.classList.remove('open');
            }
        });
    </script>
  </body>

</html>
